# File Service Discovery for Prometheus

This directory is used for JSON files containing targets generated by Ansible.

## How it works

1. The Ansible `monitoring_stack` role runs on remote servers
2. By setting the `monitoring_prometheus_delegate_host` variable in inventory, JSON files are created in this directory
3. Prometheus reads these files every 30 seconds and discovers new targets

## Target file example

```json
[
  {
    "targets": [
      "192.168.1.10:19100",
      "192.168.1.10:18080"
    ],
    "labels": {
      "job": "node_and_cadvisor",
      "instance": "server1.example.com",
      "host": "server1.example.com"
    }
  }
]
```

## Ansible Configuration

In `inventory.yml` to use this feature:

```yaml
monitoring_prometheus_delegate_host: "observability-server"
monitoring_prometheus_file_sd_dir: "/opt/observability/prometheus/file_sd/targets"
monitoring_prometheus_reload_url: "http://localhost:9090/-/reload"
```